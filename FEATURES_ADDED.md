# ویژگی‌های جدید اضافه شده

## 1. سیستم مدیریت کلیدهای API رمزشده 🔐

### KeyManager
- **دانلود خودکار** کلیدها از Google Drive
- **رمزگشایی** با الگوریتم AES-GCM + PBKDF2
- **پسورد**: `12345`
- **لینک دانلود**: https://drive.google.com/uc?export=download&id=17iwkjyGcxJeDgwQWEcsOdfbOxOah_0u0

### قابلیت‌ها:
- ✅ باز کردن قفل با رمز
- ✅ نمایش نام مدل فعال (GPT-4, OpenRouter, Gemini)
- ✅ تعویض خودکار کلید در صورت خرابی
- ✅ بروزرسانی کلیدها از سرور
- ✅ اعتبارسنجی کلید فعال

### UnlockActivity
صفحه ورود با امکانات:
- ورود رمز (پیش‌فرض: 12345)
- دانلود کلیدها از Google Drive
- نمایش وضعیت قفل
- رد شدن و ادامه بدون فعال‌سازی

---

## 2. سیستم چت هوشمند با AI 🤖

### NavigationAIAssistant
دستیار AI با قابلیت:
- ✅ چت فارسی با GPT-3.5/GPT-4
- ✅ کنترل کامل مسیریاب
- ✅ اجرای دستورات از طریق متن

### دستورات قابل اجرا:
```
START_NAVIGATION:{lat},{lon},{destLat},{destLon}
STOP_NAVIGATION
GET_LOCATION
ADD_CAMERA:{lat},{lon},{type},{speedLimit}
REPORT_TRAFFIC:{level}
```

### AIChatActivity
رابط کاربری چت شامل:
- نمایش تاریخچه چت
- دکمه‌های میانبر (شروع، توقف، موقعیت، مسیر)
- نمایش مدل فعال و ایندکس کلید
- پاک کردن تاریخچه

---

## 3. سیستم هشدارهای صوتی پیشرفته 🔊

### VoiceAlertManager
مدیریت کامل هشدارها با 15+ نوع هشدار:

#### هشدارهای دوربین:
- ✅ دوربین ثابت (500-1000 متر قبل)
- ✅ دوربین سیار (احتمالی)
- ✅ دوربین میانگین سرعت
- ✅ چراغ راهنمایی با دوربین

#### هشدارهای ایمنی:
- ✅ سرعت‌گیر (50-300 متر)
- ✅ تخطی از سرعت مجاز (3 سطح)
- ✅ پیچ خطرناک
- ✅ ورود ممنوع
- ✅ راه آهن
- ✅ منطقه مدرسه
- ✅ کار راهداری

#### هشدارهای ترافیک:
- ✅ تصادف/حادثه
- ✅ ترافیک سنگین
- ✅ خروج از مسیر
- ✅ محاسبه مجدد مسیر

#### هشدارهای مسیریابی:
- ✅ دستورات پیچ (چپ/راست)
- ✅ نزدیک شدن به مقصد
- ✅ رسیدن به مقصد

### ویژگی‌ها:
- حالت آفلاین (با TTS Engine)
- حالت آنلاین (آینده: API)
- قطع/وصل صدا
- سرعت متغیر بر اساس اهمیت

---

## 4. رابط کاربری بهبود یافته 🎨

### صفحه اصلی (MainActivity):
#### بخش جدید: تنظیمات هوش مصنوعی
- **نمایش وضعیت کلید**: مدل فعال | کلید x/y
- **دکمه بروزرسانی کلیدها**
- **سوییچ هشدارهای صوتی**
- **دکمه چت با AI**

### طراحی:
- رنگ‌بندی متمایز (#FFF3E0)
- Material Design 3
- آیکون‌ها و Switch مدرن

---

## 5. ادغام کامل با سرویس‌ها 🔗

### NavigationService:
- استفاده از `VoiceAlertManager` برای تمام هشدارها
- اتصال به `NavigationAIAssistant`
- پشتیبانی از دستورات AI

### MainActivity:
- مقداردهی `KeyManager`
- مقداردهی `VoiceAlertManager`
- اتصال به `AIChatActivity`

---

## 6. امنیت و رمزنگاری 🔒

### الگوریتم‌های استفاده شده:
- **AES-256-GCM**: رمزنگاری متقارن
- **PBKDF2-HMAC-SHA256**: مشتق‌سازی کلید
- **20,000 تکرار**: مقاومت در برابر brute-force
- **Base64 Encoding**: ذخیره‌سازی متن

### فایل‌های رمزشده:
```
encrypted_keys.b64.txt (در Google Drive)
  ↓ دانلود
encrypted_keys.b64 (محلی)
  ↓ رمزگشایی با پسورد
decrypted_keys.txt (موقت، حذف پس از قفل)
```

---

## 7. API پشتیبانی شده 🌐

### OpenAI:
- GPT-3.5-turbo
- GPT-4
- کلیدهای sk-proj-* و sk-*

### OpenRouter:
- دسترسی به چندین مدل
- کلیدهای sk-or-v1-*

### Gemini:
- مدل‌های Google
- کلیدهای 32 کاراکتری

---

## 8. مدیریت خطا و Fallback 🛡️

### تعویض خودکار کلید:
- در صورت 401 (Unauthorized)
- تلاش با کلید بعدی
- اعلام به کاربر

### پیام‌های خطای دوستانه:
- فارسی و واضح
- راهنمایی برای رفع مشکل

---

## 9. تجربه کاربری بهبود یافته ✨

### جریان کاری:
```
باز کردن برنامه
  ↓
UnlockActivity (ورود رمز)
  ↓
MainActivity (تمام قابلیت‌ها)
  ├→ چت AI
  ├→ مسیریابی
  ├→ نقشه
  └→ تنظیمات
```

### دکمه‌های میانبر در چت:
- شروع مسیریابی
- توقف مسیریابی
- دریافت موقعیت
- پیشنهاد مسیر

---

## 10. پشتیبانی از چند زبان 🌍

### فارسی:
- تمام رابط کاربری
- هشدارهای صوتی
- پیام‌های سیستم
- چت AI (با prompt فارسی)

---

## آمار کد جدید 📊

### فایل‌های جدید:
- `KeyManager.kt` (350 خط)
- `NavigationAIAssistant.kt` (280 خط)
- `VoiceAlertManager.kt` (420 خط)
- `UnlockActivity.kt` (120 خط)
- `AIChatActivity.kt` (180 خط)

### فایل‌های به‌روزرسانی شده:
- `MainActivity.kt` (+80 خط)
- `NavigationService.kt` (+30 خط)
- `activity_main.xml` (+65 خط)
- `AndroidManifest.xml` (+20 خط)

### layout های جدید:
- `activity_unlock.xml`
- `activity_aichat.xml`
- `item_message_user.xml`
- `item_message_ai.xml`

**جمع کل: ~1,550 خط کد جدید** 🚀

---

## نحوه استفاده 📖

### 1. باز کردن برنامه:
```
رمز پیش‌فرض: 12345
```

### 2. فعال‌سازی کلیدها:
- دکمه "باز کردن قفل"
- یا "دانلود کلیدها از Google Drive"

### 3. چت با AI:
- دکمه "چت با AI"
- نوشتن پیام یا استفاده از میانبرها

### 4. هشدارهای صوتی:
- پیش‌فرض: فعال
- غیرفعال کردن: Switch در صفحه اصلی

### 5. بروزرسانی کلیدها:
- دکمه "بروزرسانی کلیدها"
- ورود مجدد رمز

---

## توجه ⚠️

- رمز `12345` را به محض نصب تغییر دهید
- فایل کلیدهای رمزشده را به‌روز نگه دارید
- کلیدهای نامعتبر به صورت خودکار رد می‌شوند
- حتما مدل‌های TTS و ML را در assets قرار دهید

---

## لینک‌های مهم 🔗

- **فایل کلیدها**: https://drive.google.com/file/d/17iwkjyGcxJeDgwQWEcsOdfbOxOah_0u0
- **پوشه یادگیری**: https://drive.google.com/drive/folders/1bp1Ay9kmK_bjWq_PznRfkPvhhjdhSye1
- **GitHub**: https://github.com/ghadirb/PersianAINavigation

---

**✨ تمام قابلیت‌های درخواستی با موفقیت پیاده‌سازی شد!**
